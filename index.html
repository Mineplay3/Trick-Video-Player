<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLC</title>
    <link href="main.css" rel="stylesheet">
</head>
<body>
    <div class="player">
        <video id="video" oncontextmenu="return false;" muted>
            <source>
        </video>
        
        <progress id="progressbar" max="100" value="50">
    </div>

    <div id="test">0.0%</div>
</body>

<script>

    function cubicBezier(t, p1, p2) {
        // Ensure t is within the range [0, 1]
        t = Math.min(1, Math.max(0, t));

        // Calculate the coefficients for the cubic Bezier curve
        const cX = 3 * p1[0];
        const bX = 3 * (p2[0] - p1[0]) - cX;
        const aX = 1 - cX - bX;

        const cY = 3 * p1[1];
        const bY = 3 * (p2[1] - p1[1]) - cY;
        const aY = 1 - cY - bY;

        // Calculate the position on the curve for the given t
        const x = (aX * t ** 3) + (bX * t ** 2) + (cX * t);
        const y = (aY * t ** 3) + (bY * t ** 2) + (cY * t);

        return [x, y];
        }

    var video = document.getElementById("video");

    function startvid() {
        video.currentTime = 0;
        video.play();

        setTimeout(function () {
            video.muted = false;
        }, 100)

        var progress = 0.0;

        var loop = setInterval(function () {
            progress = ((video.currentTime / video.duration));

            const p1 = [0.55, 0.07];
            const p2 = [0.79, 0.63]; 

            progress2 = cubicBezier(progress, p1, p2)[0] * 100;
            // progress2 = progress * 100;

            document.getElementById('test').innerHTML = progress2 + "% | " + ((progress2-progress * 100)).toFixed(0);

            document.getElementById("progressbar").value = progress2;

            if (progress >= 100) {
                clearInterval(loop);
            }
        }, 100);

    }

    const urlParams = new URLSearchParams(window.location.search);
    const myParam = urlParams.get("vid");

    if (myParam == null) {
        document.body.innerHTML = "Vid param not set";
    }
    
    else {
        document.getElementsByTagName("source")[0].src = myParam;
        startvid();
    }
    
</script>
</html>